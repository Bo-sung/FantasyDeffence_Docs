<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì˜ì§€ ì‹œìŠ¤í…œ í”„ë¡œí† íƒ€ì…</title>
    <style>
        :root {
            --tile-size: 40px;
            --bg-color: #2c3e50;
            --ui-bg: rgba(0, 0, 0, 0.85);
            --text-color: #ecf0f1;
            --accent-color: #f1c40f;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: #1a1a1a;
            color: var(--text-color);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            user-select: none;
        }

        /* ê²Œì„ ì»¨í…Œì´ë„ˆ */
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #34495e;
            overflow: auto;
        }

        /* --- ìƒë‹¨ ìì› UI --- */
        #top-ui {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--ui-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
            z-index: 100;
            border-bottom: 2px solid #555;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }

        .res-icon { font-size: 18px; }

        /* --- ë§µ (ê·¸ë¦¬ë“œ) --- */
        #map-area {
            /* 20x20 ë§µ, ê° íƒ€ì¼ 40px */
            width: calc(20 * var(--tile-size));
            height: calc(20 * var(--tile-size));
            background-color: #27ae60; /* ì”ë”” ìƒ‰ */
            background-image: 
                linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: var(--tile-size) var(--tile-size);
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            border: 20px solid #2c3e50; /* ë§µ ì™¸ë¶€ ì—¬ë°± */
        }

        /* ê±´ë¬¼ ë° ì˜¤ë¸Œì íŠ¸ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .object {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 12px;
            font-weight: bold;
            box-sizing: border-box;
            border: 1px solid rgba(0,0,0,0.2);
            box-shadow: 2px 5px 10px rgba(0,0,0,0.4);
            transition: transform 0.2s;
            z-index: 10;
            border-radius: 4px;
        }
        
        /* ê±´ë¬¼ ì•„ì´ì½˜/ë¼ë²¨ */
        .object span.icon { font-size: 20px; display: block; margin-bottom: 2px; }

        /* ê±´ë¬¼ ì¢…ë¥˜ë³„ ìŠ¤íƒ€ì¼ */
        .obj-wall { background: #555; color: #fff; z-index: 5; border-radius: 0; box-shadow: none; border: 1px solid #444; }
        .obj-castle { 
            background: linear-gradient(135deg, #8e44ad, #9b59b6); 
            color: #fff; 
            border: 3px solid #f1c40f; 
            z-index: 6; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .obj-farm { background: #f1c40f; color: #333; }
        .obj-mine { background: #3498db; color: #fff; }
        .obj-barracks { background: #c0392b; color: #fff; }
        .obj-tavern { background: #e67e22; color: #fff; }

        /* ë¯¸ë¦¬ë³´ê¸° (ê³ ìŠ¤íŠ¸) */
        .preview {
            position: absolute;
            background: rgba(46, 204, 113, 0.6);
            border: 2px dashed #fff;
            pointer-events: none;
            z-index: 50;
            display: none;
            border-radius: 4px;
            transition: background 0.1s;
        }
        .preview.invalid {
            background: rgba(231, 76, 60, 0.6);
            border-color: #c0392b;
        }

        /* ì˜ì›… (ëŒì•„ë‹¤ë‹ˆëŠ” NPC) */
        .hero {
            position: absolute;
            width: 24px;
            height: 24px;
            background: #fff;
            border-radius: 50%;
            border: 2px solid var(--accent-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            transition: top 2s linear, left 2s linear; /* ë¶€ë“œëŸ¬ìš´ ì´ë™ */
            z-index: 20;
            box-shadow: 0 5px 5px rgba(0,0,0,0.3);
        }

        /* --- í•˜ë‹¨ ë©”ë‰´ UI --- */
        #bottom-ui {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--ui-bg);
            padding: 15px 25px;
            border-radius: 15px;
            display: flex;
            gap: 15px;
            z-index: 100;
            border: 1px solid #555;
            backdrop-filter: blur(5px);
        }

        .btn-build {
            background: #34495e;
            border: 1px solid #7f8c8d;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            width: 80px;
            height: 80px;
            transition: all 0.2s;
        }
        .btn-build:hover { transform: translateY(-5px); background: #3d566e; }
        .btn-build.active {
            background: #1abc9c;
            border-color: #16a085;
            box-shadow: 0 0 10px #1abc9c;
        }
        .btn-build .b-icon { font-size: 24px; }
        .btn-build .b-name { font-size: 11px; opacity: 0.9; }
        .btn-build .b-size { font-size: 10px; opacity: 0.6; }

    </style>
</head>
<body>

    <div id="top-ui">
        <div class="resource-item"><span class="res-icon">ğŸŒ¾</span> ì‹ëŸ‰ <span id="res-food">1,000</span></div>
        <div class="resource-item"><span class="res-icon">ğŸ’</span> ë§ˆì„ <span id="res-magic">500</span></div>
        <div class="resource-item"><span class="res-icon">ğŸ“¦</span> ë³´ê¸‰ <span id="res-supply">200</span></div>
        <div class="resource-item"><span class="res-icon">â›‘ï¸</span> ì¸ë ¥ <span id="res-man">50</span></div>
        <div class="resource-item"><span class="res-icon">ğŸª™</span> ì€í™” <span id="res-silver">5,000</span></div>
    </div>

    <div id="game-container">
        <div id="map-area">
            <div id="preview-box" class="preview"></div>
        </div>
    </div>

    <div id="bottom-ui">
        <button class="btn-build" onclick="setBuildMode('farm', 2, 2, 'ğŸŒ¾')">
            <span class="b-icon">ğŸŒ¾</span>
            <span class="b-name">ë†ì¥</span>
            <span class="b-size">2x2</span>
        </button>
        <button class="btn-build" onclick="setBuildMode('mine', 2, 2, 'ğŸ’')">
            <span class="b-icon">ğŸ’</span>
            <span class="b-name">ê´‘ì‚°</span>
            <span class="b-size">2x2</span>
        </button>
        <button class="btn-build" onclick="setBuildMode('barracks', 2, 2, 'âš”ï¸')">
            <span class="b-icon">âš”ï¸</span>
            <span class="b-name">í›ˆë ¨ì†Œ</span>
            <span class="b-size">2x2</span>
        </button>
        <button class="btn-build" onclick="setBuildMode('tavern', 3, 2, 'ğŸº')">
            <span class="b-icon">ğŸº</span>
            <span class="b-name">ì£¼ì </span>
            <span class="b-size">3x2</span>
        </button>
        <button class="btn-build" style="background:#c0392b" onclick="cancelBuildMode()">
            <span class="b-icon">âŒ</span>
            <span class="b-name">ì·¨ì†Œ</span>
        </button>
    </div>

    <script>
        // --- 1. ì„¤ì • ë° ì´ˆê¸°í™” ---
        const TILE_SIZE = 40;
        const MAP_SIZE = 20; // 20x20 ê²©ì
        const mapArea = document.getElementById('map-area');
        const previewBox = document.getElementById('preview-box');
        
        // ë§µ ë°ì´í„° (0: ë¹ˆë•…, 1: ì ìœ ë¨)
        let mapData = Array(MAP_SIZE).fill().map(() => Array(MAP_SIZE).fill(0));
        
        let currentBuildMode = null; // í˜„ì¬ ì„ íƒëœ ê±´ë¬¼ ì •ë³´ { type, w, h, icon }

        // --- 2. ë§µ ìƒì„± í•¨ìˆ˜ ---
        function initMap() {
            // ì„±ë²½ ë°°ì¹˜ (ì™¸ê³½ì„ )
            for(let y=0; y<MAP_SIZE; y++) {
                for(let x=0; x<MAP_SIZE; x++) {
                    if(y===0 || y===MAP_SIZE-1 || x===0 || x===MAP_SIZE-1) {
                        createBuildingElement('wall', x, y, 1, 1, 'ğŸ§±', 'ì„±ë²½');
                        mapData[y][x] = 1;
                    }
                }
            }

            // ì˜ì£¼ì„± ë°°ì¹˜ (ì¤‘ì•™)
            const cx = Math.floor(MAP_SIZE/2) - 2; // 4x4 í¬ê¸°ë¼ ì¤‘ì‹¬ ì¡ê¸°
            const cy = Math.floor(MAP_SIZE/2) - 2;
            createBuildingElement('castle', cx, cy, 4, 4, 'ğŸ°', 'ì˜ì£¼ì„±');
            
            // ì˜ì£¼ì„± ìë¦¬ ì ìœ  ì²˜ë¦¬
            for(let y=cy; y<cy+4; y++){
                for(let x=cx; x<cx+4; x++){
                    mapData[y][x] = 1;
                }
            }

            // ì´ˆê¸° ì˜ì›… ì†Œí™˜
            spawnHero('ğŸ¤´');
            spawnHero('ğŸ›¡ï¸');
            spawnHero('ğŸ§™â€â™‚ï¸');
        }

        // --- 3. ê±´ë¬¼ ìƒì„± ë° ë°°ì¹˜ ---
        function createBuildingElement(type, x, y, w, h, icon, name = '') {
            const div = document.createElement('div');
            div.className = `object obj-${type}`;
            div.style.left = `${x * TILE_SIZE}px`;
            div.style.top = `${y * TILE_SIZE}px`;
            div.style.width = `${w * TILE_SIZE}px`;
            div.style.height = `${h * TILE_SIZE}px`;
            
            div.innerHTML = `<span class="icon">${icon}</span>${name ? `<span>${name}</span>` : ''}`;
            mapArea.appendChild(div);
        }

        // --- 4. ì¸í„°ë™ì…˜ (ê±´ì„¤ ëª¨ë“œ) ---
        function setBuildMode(type, w, h, icon) {
            currentBuildMode = { type, w, h, icon };
            
            // ë²„íŠ¼ í™œì„±í™” UI ì²˜ë¦¬
            document.querySelectorAll('.btn-build').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function cancelBuildMode() {
            currentBuildMode = null;
            previewBox.style.display = 'none';
            document.querySelectorAll('.btn-build').forEach(btn => btn.classList.remove('active'));
        }

        // ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸ (ë¯¸ë¦¬ë³´ê¸°)
        mapArea.addEventListener('mousemove', (e) => {
            if (!currentBuildMode) return;

            const rect = mapArea.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            // ê·¸ë¦¬ë“œ ì¢Œí‘œ ê³„ì‚°
            const gx = Math.floor(mouseX / TILE_SIZE);
            const gy = Math.floor(mouseY / TILE_SIZE);

            // ë²”ìœ„ ì²´í¬
            if (gx < 0 || gy < 0 || gx + currentBuildMode.w > MAP_SIZE || gy + currentBuildMode.h > MAP_SIZE) {
                previewBox.style.display = 'none';
                return;
            }

            // ë¯¸ë¦¬ë³´ê¸° ìœ„ì¹˜ ì—…ë°ì´íŠ¸
            previewBox.style.display = 'block';
            previewBox.style.width = `${currentBuildMode.w * TILE_SIZE}px`;
            previewBox.style.height = `${currentBuildMode.h * TILE_SIZE}px`;
            previewBox.style.left = `${gx * TILE_SIZE}px`;
            previewBox.style.top = `${gy * TILE_SIZE}px`;

            // ì¶©ëŒ ì²´í¬ ë° ìƒ‰ìƒ ë³€ê²½
            if (checkCollision(gx, gy, currentBuildMode.w, currentBuildMode.h)) {
                previewBox.classList.add('invalid'); // ë¹¨ê°„ìƒ‰
            } else {
                previewBox.classList.remove('invalid'); // ì´ˆë¡ìƒ‰
            }
        });

        // í´ë¦­ ì´ë²¤íŠ¸ (ê±´ì„¤ í™•ì •)
        mapArea.addEventListener('click', (e) => {
            if (!currentBuildMode) return;
            if (previewBox.classList.contains('invalid')) {
                alert("ì—¬ê¸°ì— ì§€ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
                return;
            }
            if (previewBox.style.display === 'none') return;

            // í˜„ì¬ ë¯¸ë¦¬ë³´ê¸° ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
            const left = parseInt(previewBox.style.left);
            const top = parseInt(previewBox.style.top);
            const gx = left / TILE_SIZE;
            const gy = top / TILE_SIZE;

            // ê±´ë¬¼ ìƒì„±
            createBuildingElement(currentBuildMode.type, gx, gy, currentBuildMode.w, currentBuildMode.h, currentBuildMode.icon);

            // ë°ì´í„° ì ìœ  ì—…ë°ì´íŠ¸
            for(let y=gy; y<gy+currentBuildMode.h; y++){
                for(let x=gx; x<gx+currentBuildMode.w; x++){
                    mapData[y][x] = 1;
                }
            }

            // ìì› ì°¨ê° ì—°ì¶œ (ë‹¨ìˆœ ë¡œê·¸)
            console.log(`${currentBuildMode.type} ê±´ì„¤ ì™„ë£Œ! ìì› ì†Œëª¨.`);
        });

        // ì¶©ëŒ ì²´í¬ í•¨ìˆ˜
        function checkCollision(x, y, w, h) {
            for(let i=y; i<y+h; i++) {
                for(let j=x; j<x+w; j++) {
                    if (mapData[i][j] !== 0) return true; // ì´ë¯¸ ì ìœ ë¨
                }
            }
            return false;
        }


        // --- 5. ì˜ì›… ìƒí™œ (AI) ---
        function spawnHero(icon) {
            const hero = document.createElement('div');
            hero.className = 'hero';
            hero.innerText = icon;
            
            // ëœë¤ ì‹œì‘ ìœ„ì¹˜ (ì„±ë²½ ì•ˆìª½)
            let x = 5, y = 5;
            hero.style.left = `${x * TILE_SIZE}px`;
            hero.style.top = `${y * TILE_SIZE}px`;
            
            mapArea.appendChild(hero);

            // ì£¼ê¸°ì ìœ¼ë¡œ ì´ë™
            setInterval(() => {
                const directions = [[0,1], [0,-1], [1,0], [-1,0]]; // ìƒí•˜ì¢Œìš°
                const dir = directions[Math.floor(Math.random() * directions.length)];
                
                const nextX = x + dir[0];
                const nextY = y + dir[1];

                // ë§µ ë°–ìœ¼ë¡œ ì•ˆ ë‚˜ê°€ê²Œ & ì„±ë²½ ì•ˆëš«ê²Œ (ê°„ë‹¨ ì²´í¬)
                if(nextX > 1 && nextX < MAP_SIZE-2 && nextY > 1 && nextY < MAP_SIZE-2) {
                    x = nextX;
                    y = nextY;
                    hero.style.left = `${x * TILE_SIZE + 5}px`; // +5ëŠ” ì¤‘ì•™ ì •ë ¬ ë³´ì •
                    hero.style.top = `${y * TILE_SIZE + 5}px`;
                }
            }, 2000 + Math.random() * 1000); // 2~3ì´ˆë§ˆë‹¤ ì´ë™
        }

        // ì‹¤í–‰
        initMap();

    </script>
</body>
</html>
# 전투 메카닉

[← README로 돌아가기](../README.md)

---

## 개요

전투에서 사용되는 수치 계산, 스탯, 스킬 등의 핵심 로직을 정의합니다.

---

## 문서 구성

| 문서 | 내용 |
|------|------|
| [스탯 시스템](스탯%20시스템.md) | 엔티티 스탯 정의, 역할별 스탯 경향, 레벨 성장 |
| [스킬 시스템](스킬%20시스템.md) | 스킬 분류, 발동 조건, 쿨다운 |

---

## 핵심 요소 요약

### 스탯

| 스탯 | 설명 |
|------|------|
| HP | 체력, 0이 되면 전사/파괴 |
| ATK/MAG | 물리/마법 공격력 |
| DEF/RES | 물리/마법 방어력 |
| SPD/MOV | 공격속도/이동속도 |
| RNG | 사거리 |
| CRT/EVA | 치명타율/회피율 |

---

## 데미지 계산 공식

> 모든 엔티티 간 피해 계산에 동일 적용 (평타, 스킬 공통)

### 통합 공식

**Phase 1 (초기 버전)**
```
최종 피해 = 피해량 × (100 / (100 + 방어력)) × 치명타 배율
```

**Phase 2 (속성 추가 시)**
```
최종 피해 = 피해량 × (100 / (100 + 방어력)) × 치명타 배율 × 속성 배율
```

### 1단계: 피해량 계산

| 공격 유형 | 물리 피해량     | 마법 피해량     |
| ----- | ---------- | ---------- |
| 평타    | ATK        | MAG        |
| 스킬    | 각 스킬 마다 다름 | 각 스킬 마다 다름 |

#### 스킬 계수 예시

| 스킬   | 피해량 공식         | 설명        |
| ---- | -------------- | --------- |
| 강타   | ATK × 1.5      | 순수 계수형    |
| 파이어볼 | 50 + MAG × 2.0 | 기본값 + 계수형 |
| 연속베기 | ATK × 0.8 × 3회 | 다단히트      |
| 관통사격 | ATK × 1.2 (관통) | 특수 효과 포함  |

### 2단계: 방어력 적용

| 피해 타입 | 적용 방어력 | 계산식                       |
| ----- | ------ | ------------------------- |
| 물리    | DEF    | 피해량 × (100 / (100 + DEF)) |
| 마법    | RES    | 피해량 × (100 / (100 + RES)) |

#### 방어력 효율

| DEF/RES | 피해 감소율 |
| ------- | ------ |
| 0       | 0%     |
| 50      | 33%    |
| 100     | 50%    |
| 200     | 67%    |
| 300     | 75%    |

- 방어 스탯은 수확체감 구조 (무한 스택 방지)

### 3단계: 추가 배율

| 배율 종류 | 조건 | 배율 | 적용 시기 |
|-----------|------|------|-----------|
| 치명타 | CRT 확률로 발동 | ×1.5 | Phase 1 |
| 속성 강점 | 상성 우위 | ×1.5 | Phase 2 |
| 속성 약점 | 상성 열위 | ×0.75 | Phase 2 |

### 계산 예시

#### 예시 1: 평타 (물리)
```
ATK 100, 대상 DEF 50, 치명타 미발동
피해량 = 100
방어 적용 = 100 × (100 / 150) = 66.7
최종 피해 = 66.7
```

#### 예시 2: 스킬 (마법, 속성 우위)
```
파이어볼: 50 + MAG × 2.0
MAG 80, 대상 RES 30, 화염 속성, 대상 자연 속성 (약점)
피해량 = 50 + (80 × 2.0) = 210
방어 적용 = 210 × (100 / 130) = 161.5
속성 배율 = 161.5 × 1.5 = 242.3
최종 피해 = 242.3
```

---

## 속성 상성 (Phase 2)

> 초기 버전에서는 미적용, 후반 업데이트에서 추가 예정

| 속성 | 강함 (1.5배) | 약함 (0.75배) |
|------|--------------|---------------|
| 화염 | 자연/빙결 | 수속성 |
| 빙결 | 수속성 | 화염 |
| 번개 | 수속성/기계 | 대지 |
| 대지 | 번개 | 자연 |
| 자연 | 대지 | 화염 |
| 암흑 | 신성 | 신성 |
| 신성 | 암흑 | 암흑 |

### 상태이상

**디버프**: 화상, 빙결, 감전, 중독, 출혈, 스턴

**버프**: 공격 강화, 방어 강화, 신속, 재생, 보호막

---

## 진영 시스템

| 진영 | 소속 |
|------|------|
| ALLY | 영웅, 병사, 바리케이드, 성벽, 성벽무기 |
| ENEMY | 몬스터, 보스 |
| NEUTRAL | 환경 오브젝트 |

- 같은 진영끼리는 피해 무효
- 아군 스킬(힐/버프)은 ALLY에만 적용

---

## 관련 문서

- [스탯 시스템](스탯%20시스템.md) - 상세 스탯 정의
- [스테이지 시스템](스테이지%20시스템.md) - 맵, 웨이브, 배치
- [영웅 시스템](영웅%20시스템.md) - 역할별 특성
- [링크 시스템](영웅/링크%20시스템.md) - HP/링크 메커니즘

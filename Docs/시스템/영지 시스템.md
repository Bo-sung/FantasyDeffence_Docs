# 영지 시스템

[← README로 돌아가기](../README.md)

---

## 컨셉

- **유사 하우징 시스템**: 서브컬처 게임의 카페/기지처럼 내 공간 꾸미기
- **자유 배치**: 격자 기반 타일맵에 건물 자유 배치
- **영웅 생활**: 배치된 영웅이 영지 내 돌아다님

---

## 맵 구조

### 비정형 맵 + 구역 확장

```
            ┌─────────┐
            │  산악   │ 거리 3
        ┌───┴─────────┴───┐
        │      숲         │ 거리 2
    ┌───┴─────────────────┴───┐
    │         평원             │ 거리 1
┌───┴─────────────────────────┴───┐
│          ★ 영주성 ★             │ 기본
└───┬─────────────────────────┬───┘
    │         강변             │ 거리 1
    └───┬─────────────────┬───┘
        │      습지       │ 거리 2
        └───┬─────────┬───┘
            │  해안   │ 거리 3
            └─────────┘
```

### 구역 확장 (거리 기반)

| 거리 | 구역 | 해금 조건 | 비용 |
|------|------|-----------|------|
| 0 | 시작 영역 | 기본 | - |
| 1 | 평원, 강변 | 영주성 Lv.10 | 5,000 |
| 2 | 숲, 습지 | 영주성 Lv.25 | 12,000 |
| 3 | 산악, 해안 | 영주성 Lv.40 | 20,000 |

- **영주성 레벨** 조건 충족 시 해금 가능
- 같은 거리면 **방향 자유 선택**
- **인접 구역 해금 필수** (건너뛰기 불가)
- 각 구역별 **지형 보너스** (농장+10%, 마력정제소+10% 등)

### 고정 요소

| 요소 | 위치 | 설명 |
|------|------|------|
| 영주성 | 시작 영역 중앙 | 핵심 시설, 이동 불가, 세금 수령 |
| 성벽 | 외곽 | 경계 표시, 장식 요소 |

### 배치 시스템

| 기능 | 설명 |
|------|------|
| 드래그 앤 드롭 | 건물을 원하는 위치에 배치 |
| 건물 회전 | 배치 시 방향 조절 (0°, 90°, 180°, 270°) |
| 도로 | 장식용 (기능 없음, 데코) |
| 충돌 검사 | 건물 겹침 불가 |

### 제외 요소 (단순화)

- 인접 보너스 없음 (농장끼리 붙여도 효율 동일)
- 도로 연결 시스템 없음

---

## 주요 시설

### 생산 시설

| 시설 | 생산 자원 | 용도 | 크기 |
|------|-----------|------|------|
| 농장 | 식량 | 출격 부대 유지 (링크 비례) | 2×2 |
| 마력 정제소 | 마석 | 마법 포대 출격 | 2×2 |
| 보급창고 | 보급 | 물리 포탑 출격, 소모품 재료 | 2×2 |
| 훈련소 | 인력 | 링크 확장/수리 | 2×2 |

### 주거 시설 (인구 → 세금)

| 시설 | 인구 | 크기 |
|------|------|------|
| 민가 | 2명 | 1×1 |
| 연립 주택 | 6명 | 1×2 |
| 상가 건물 | 4명 | 2×2 |

### 편의 시설 (만족도)

| 시설 | 만족도 | 크기 |
|------|--------|------|
| 우물 | +5% | 1×1 |
| 방앗간 | +10% | 2×2 |
| 교회 | +15% | 2×3 |
| 광장 | +10% | 3×3 |
| 시장 | +20% | 3×2 |

### 군사 시설

| 시설 | 기능 | 크기 |
|------|------|------|
| 무기고 | 성벽 무기 업그레이드 | 2×2 |
| 공병 작업장 | 소모품 제작 (목책 등) | 2×2 |
| 수리실 | 영웅 수리 (슬롯 관리) | 2×2 |

### 기능 시설

| 시설 | 기능 | 크기 |
|------|------|------|
| 주점 | 영웅 영입 | 3×2 |
| 대장간 | 장비 제작/강화 | 2×2 |
| 도서관 | 스킬북 획득, 연구 | 2×2 |

### 장식 시설

| 시설  | 기능  | 크기  |
| --- | --- | --- |
| 도로  | 장식용 | 1×1 |
| 가로등 | 장식용 | 1×1 |
| 분수  | 장식용 | 2×2 |
| 정원  | 장식용 | 다양  |

---

## 시설 운영

### 시설 레벨업

- 건설 재료 + 은화 소모
- 생산량/효율 증가
- 새로운 기능 해금

### 영웅 배치

- 시설에 영웅 배치로 보너스
- 특정 영웅은 특정 시설에 특화 보너스
- **배치 중 영웅은 전투 불가**
- 영웅이 영지 내 돌아다니는 모습 표시 (하우징 요소)

### 자동 생산

- 시간당 일정량 자동 생산
- **만족도에 따라 생산량 변동** (50% ~ 150%)
- 최대 저장량 존재 (넘치면 손실)
- 정기적 수확 필요

### 세금 시스템

```
세금(은화) = 세금 계수 × 인구수 × 만족도
```

- 세금 계수: 영주성 레벨에 따라 증가
- 인구수: 주거 시설 (민가, 연립, 상가) 합산
- 만족도: 편의 시설 (우물, 방앗간, 교회 등)
- **수령 방식**: 영주성 탭하여 수동 수확

---

## 영지와 전투의 연결

### 성벽 무기

- 무기고 레벨 = 성벽 무기 성능
- 모든 전투에 영향

### 소모품

- 공병 작업장에서 제작 (목책 등)
- 전투 배치 시 소모

### 전투 자원

- 농장 → 식량 (부대 유지)
- 마력 정제소 → 마석 (마법 포대)
- 보급창고 → 보급 (물리 포탑, 소모품)
- 훈련소 → 인력 (링크 확장/수리)

---

## 데이터 구조 (참고)

### 배치 정보

```
building_placement {
  user_id      -- 유저 ID
  building_id  -- 건물 종류
  x, y         -- 좌표
  rotation     -- 회전 (0, 90, 180, 270)
  level        -- 건물 레벨
}
```

---

## 관련 문서

- [스테이지 시스템](스테이지%20시스템.md) - 성벽 무기
- [수리 시스템](영웅/수리%20시스템.md) - 수리실
- [재화 시스템](재화%20시스템.md) - 자원 종류

---
tags: [plan, client, server]
---

# 맵·구역 시스템

[← 영지 시스템](../영지%20시스템.md)

---

## 격자 스펙

| 항목 | 값 |
|------|-----|
| 전체 맵 | 64 × 64 타일 |
| 타일 크기 | 1 × 1 (기본 단위) |
| 블록 크기 | 8 × 8 타일 (64타일) |
| 블록 그리드 | 8 × 8 블록 (총 64개 블록) |
| 시작 영역 | 중앙 1블록 (8×8 타일, 64타일), 기본 해금 |
| 영주성 | 시작 영역 내 중앙 건물 (별도 엔티티) |
| 확장 구역 | 63개 블록 (시작 영역 제외) |

---

## 맵 구조

> **용어 정의:**
> - **타일**: 1×1 최소 건설 단위
> - **블록**: 8×8 타일의 정형 공간 (64타일)
> - **맵**: 64×64 타일 전체 = 8×8 블록 그리드 (고정)
> - **구역**: 블록 단위 영역 (0번: 시작 영역, 1~63번: 확장 가능 구역)
> - **구역 테마**: 지형별 비주얼 명칭 (평원, 강변, 숲, 습지, 산악, 해안 등)
>   - 게임플레이 효과 없음 (동네 이름처럼 장식적 요소)
> - **영주성**: 시작 영역 내 중앙 핵심 건물 (구역과 별개 엔티티)

### 개념도

**8×8 블록 그리드** (64개 블록: 0번 시작 블록 + 1~63번 확장 블록)

![영지 개념도](../../assets/diagrams/영지%20개념도%20이미지.png)

- **전체 맵**: 64×64 타일 (4,096타일)
- **블록 크기**: 8×8 타일 (64타일/블록)
- **시작 블록**: 중앙 1개 (블록 0번)
- **확장 블록**: 60개 (레벨별 해금)

**블록 구조 상세**

![영지 영역 구조 상세](../../assets/diagrams/영지%20영역%20구조%20상세%20이미지.png)

- 블록 단위로 해금/구매 (8×8 타일)
- 각 블록은 독립적인 지형 테마
- 영주성은 시작 블록(0번) 내 중앙 위치

---

## 영역 확장 시스템

> 영역 = 건설 가능한 타일의 집합
> 영역 확장 = 새로운 타일 해금 → 건설 가능 부지 증가

### 시작 블록 (블록 0번)

- **기본 제공**: 게임 시작 시 자동 해금
- **위치**: 8×8 블록 그리드 중앙
- **크기**: 8×8 타일 (64타일)
- **포함 요소**: 영주성 (중앙 핵심 건물)
- **특징**: 이동/삭제 불가, 확장 불가

### 확장 조건

| 항목 | 설명 |
|------|------|
| **구매 제한 해제** | 영주성 레벨 10 이상 |
| **구매 비용** | 은화 (시작 블록으로부터 거리에 따라 증가) |
| **확장 단위** | 블록 단위 (8×8 타일) |

### 레벨별 확장 가능 블록 테마

| 레벨 | 확장 가능 블록 | 비고 |
|------|----------------|------|
| 1 | 시작 블록 (중앙) | 기본 제공 |
| 10 | 인접 블록 (평원, 강변) | 블록 확장 해금 |
| 25 | 2차 링 블록 (숲, 습지) | 더 먼 블록 확장 |
| 40 | 최외곽 블록 (산악, 해안) | 가장 먼 블록 확장 |

> **참고**: 블록 테마는 비주얼 명칭일 뿐, 게임플레이 효과(생산 보너스 등)는 없습니다.

### 확장 규칙

**시스템 제약 (필수)**:
- **인접 블록만 확장 가능**: 기존 해금된 블록에 인접한 블록만 구매 가능
- **블록 단위 확장**: 8×8 타일 블록 전체를 한 번에 구매

**확장 순서 (권장)**:
1. 시작 블록(0번) 인접 블록 (상하좌우 4개)
2. 1차 링 블록 (대각선 포함 8개)
3. 2차 링 블록 이후 순차 확장

> **참고**: 블록 단위 확장으로 정형화된 영역 관리

---

## 고정 요소

| 요소 | 위치 | 설명 |
|------|------|------|
| 시작 블록 | 맵 중앙 (8×8 타일, 블록 0번) | 기본 해금 블록, 확장 불가 |
| 영주성 | 시작 블록 내 중앙 | 핵심 건물, 이동 불가, 세금 수령 |

---

## 맵 데이터 구조

```csharp
// 맵 전체: 64×64 타일
const int MapSizeX = 64;
const int MapSizeY = 64;

// 블록 그리드: 8×8 블록
const int BlockSize = 8;
const int BlockGridX = 8;
const int BlockGridY = 8;

// 건물 배치: 0=빈 타일, 1=점유 타일
int[,] occupancyMap = new int[MapSizeY, MapSizeX];

// 블록 해금: false=미해금 (건설 불가), true=해금 (건설 가능)
// 시작 블록 (블록 0번)은 기본적으로 true
bool[,] unlockedBlocks = new bool[BlockGridY, BlockGridX];

// 타일 좌표 → 블록 인덱스 변환
public (int blockX, int blockY) GetBlockIndex(int tileX, int tileY)
{
    return (tileX / BlockSize, tileY / BlockSize);
}

// 타일 해금 여부 확인
public bool IsTileUnlocked(int x, int y)
{
    if (x < 0 || x >= MapSizeX || y < 0 || y >= MapSizeY)
        return false;

    var (blockX, blockY) = GetBlockIndex(x, y);
    return unlockedBlocks[blockY, blockX];
}

// 건설 가능 여부 확인
public bool CanBuild(int x, int y)
{
    return IsTileUnlocked(x, y) && occupancyMap[y, x] == 0;
}

// 블록 구매
public bool UnlockBlock(int blockX, int blockY)
{
    if (blockX < 0 || blockX >= BlockGridX || blockY < 0 || blockY >= BlockGridY)
        return false;

    if (unlockedBlocks[blockY, blockX])
        return false; // 이미 해금됨

    // 인접 블록 확인
    if (!HasAdjacentUnlockedBlock(blockX, blockY))
        return false; // 인접 블록 없음

    unlockedBlocks[blockY, blockX] = true;
    return true;
}

// 인접 해금 블록 존재 여부
private bool HasAdjacentUnlockedBlock(int blockX, int blockY)
{
    int[] dx = {-1, 1, 0, 0};
    int[] dy = {0, 0, -1, 1};

    for (int i = 0; i < 4; i++)
    {
        int nx = blockX + dx[i];
        int ny = blockY + dy[i];

        if (nx >= 0 && nx < BlockGridX && ny >= 0 && ny < BlockGridY)
        {
            if (unlockedBlocks[ny, nx])
                return true;
        }
    }

    return false;
}
```
